
{% block content %}
{% load custom_tags %}

<div class="container py-5">
<h2 class="mb-4">Upload File (CSV/Excel)</h2>

<form method="post" enctype="multipart/form-data" id="upload-form">
    {% csrf_token %}
    <div class="drop-zone mb-3" id="drop-area">
    <p class="mb-2">Drag & drop file ke sini atau klik untuk memilih</p>
    <input type="file" name="file" id="fileElem" class="form-control d-none" onchange="showFileName(this)">
    <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('fileElem').click()">Pilih File</button>
    <p class="mt-2" id="file-name"></p>
    </div>
    <button type="submit" class="btn btn-primary">Upload</button>
</form>
{% if sukses %}
    <div class="alert alert-success mt-3">
        {{ sukses }}
    </div>
{% endif %}

{% if error %}
    <div class="alert alert-danger mt-3">
        {{ error }}
    </div>
{% endif %}

{% if data %}
    <hr class="my-5">
    <h4>Data dari File:</h4>
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    {% for col in columns%}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                    <tr>
                        {% for col in columns %}
                            <td>{{ row|get_item:col }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p>Belum ada data yang ditampilkan.</p>
{% endif %}

</div>
{%endblock %}
{% block script %}

<style>
    .drop-zone {
        border: 2px dashed #6c757d;
        padding: 40px;
        text-align: center;
        color: #6c757d;
        transition: background 0.2s ease-in-out;
        cursor: pointer;
    }
    .drop-zone.dragover {
        background-color: #e9ecef;
    }
</style>
<script>
    const dropArea = document.getElementById('drop-area');
    const fileElem = document.getElementById('fileElem');
    const fileNameDisplay = document.getElementById('file-name');

    dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('dragover');
    });

    dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('dragover');
    });

    dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        fileElem.files = files;
        showFileName(fileElem);
    });

    function showFileName(input) {
        if (input.files.length > 0) {
        fileNameDisplay.textContent = 'ðŸ“Ž ' + input.files[0].name;
        }
    }
</script>
{% endblock %}